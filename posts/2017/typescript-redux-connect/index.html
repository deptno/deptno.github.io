<!DOCTYPE html><html><head><meta charset="utf-8"><title>TypeScript와 Redux connect | 봉로그</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="redux connect를 제대로 typing 해보자"><meta property="og:type" content="article"><meta property="og:title" content="TypeScript와 Redux connect"><meta property="og:url" content="http://blog.bglee.me/posts/2017/typescript-redux-connect/index.html"><meta property="og:site_name" content="봉로그"><meta property="og:description" content="redux connect를 제대로 typing 해보자"><meta property="og:locale" content="ko"><meta property="og:updated_time" content="2018-03-29T06:03:19.633Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="TypeScript와 Redux connect"><meta name="twitter:description" content="redux connect를 제대로 typing 해보자"><link rel="icon" href="../../../favicon.png"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-74859643-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-74859643-1")</script><link href="https://fonts.googleapis.com/css?family=Lato:400,400i,700" rel="stylesheet"><link rel="stylesheet" href="../../../icomoon/style.css"><link rel="stylesheet" href="../../../style.css"></head><body><div class="site-wrapper"><div id="loading-bar-wrapper"><div id="loading-bar"></div></div><script>document.getElementById("loading-bar").style.width="20%"</script><header id="header" class="site-header clearfix"><a class="logo square clearfix" href="../../../index.html"><span class="b">봉 </span><span class="b">로 </span><span class="b">그 </span></a><a class="me square site-nav-switch clearfix"><span class="b"><span class="icon icon-menu"></span></span></a></header><script>document.getElementById("loading-bar").style.width="40%"</script><main id="main" class="clearfix"><article id="post-typescript-redux-connect" class="article white-box article-type-post" itemscope itemprop="blogPost"><header class="article-header"><h1 class="article-title" itemprop="name">TypeScript와 Redux connect</h1><div class="article-meta">Posted on <time class="article-time" datetime="2017-10-02T15:00:00.000Z" itemprop="datePublished">10월 3, 2017</time></div></header><div class="article-entry" itemprop="articleBody"><p>타입스크립트와 리덕스로 SPA를 구현하는데 있어 기본적인 셋업이 아닌 문법적인 측면에 포커싱된 글로 타입스크립트를 활용하는데 도움이 되었으면한다.</p><p>필자는 하드 타이핑을 하지 않으며 추가적으로 린트를 쓰지 않는다. 리덕스는 자체적으로 타입스크립트 데피니션 파일(d.ts)을 가지고 있으므로 따로 타입 관련 패키지를 설치하지 않아도 된다.</p><h2><span id="설치">설치</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev typescript</span><br><span class="line">npm install redux</span><br></pre></td></tr></table></figure><h2><span id="redux">redux</span></h2><p>리덕스에 대한 설명을 돕기 위해 루트 스토어가 가지는 스테이트의 타입을 아래와 같이 정의하기로한다.</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.d.ts</span></span><br><span class="line"><span class="keyword">interface</span> RootState &#123;</span><br><span class="line">	bglee: User</span><br><span class="line">	deptno: User</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> User &#123;</span><br><span class="line">	name: <span class="built_in">string</span></span><br><span class="line">	email: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="connectargs">connect(..args)</span></h3><p>리덕스를 쓰면서 가장 많이 쓰게 되는 함수일텐데 코드를 먼저 보이면 아래와 같다.</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;connect, bindActionCreataors&#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> StateProps &#123;&#125;</span><br><span class="line"><span class="keyword">interface</span> DispatchProps &#123;&#125;</span><br><span class="line"><span class="keyword">interface</span> OwnProps &#123;&#125;</span><br><span class="line"><span class="keyword">type</span> Props = StateProps &amp; DispatchProps &amp; OwnProps</span><br><span class="line"><span class="keyword">interface</span> State &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Container = connect&lt;StateProps, DispatchProps, OwnProps&gt;(</span><br><span class="line">	(state: RootState) =&gt; (&#123;&#125;),</span><br><span class="line">	dispatach =&gt; bindActionCreators(&#123;&#125;, dispatch)</span><br><span class="line">)(</span><br><span class="line">	<span class="keyword">class</span> Component <span class="keyword">extends</span> React.Component&lt;Props, State&gt; &#123;</span><br><span class="line">		render() &#123;</span><br><span class="line">			<span class="keyword">return</span>	&lt;p&gt;hello world&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">		&#125;</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure><p>위 코드는 완전히 동작하는 코드이고 컨테이너를 정의하기 위해 풀어쓴 기본적인 형태다. 참고로 connect 함수는 추가적인 옵션을 기술하기 위해 4개까지 인자를 받을 수 있다.</p><p>connect를 보면 3개의 타입을 받고 있다. 순서대로 살펴 보겠다.</p><h4><span id="stateprops">StateProps</span></h4><p>connect의 첫번째 인자는 <code>mapStateToProps</code>로 정의되어 있으며 함수 명과 같이 <code>Store</code>의 state를 <code>Component</code>의 props로 주입하는 함수다. 이 함수의 리턴 타입이라고 생각하면 된다.</p><p>예를 들어 Store에 <code>bglee</code>라는 프로퍼티를 연결하고자 한다면 <code>mapStateToProps</code>는 아마도 다음과 같이 작성되게 된다.</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapStaetToProps = <span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.bglee</span><br></pre></td></tr></table></figure><p>그러면 Container는 props로 bglee가 가지고 있는 <code>name</code>, <code>email</code>을 받게 된다. 그럼 그에 맞춰서 <code>StateProps</code>를 정의하면 된다.</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> StateProps &#123;</span><br><span class="line">	name: <span class="built_in">string</span></span><br><span class="line">	email: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>작성하고 보니 <code>User</code> 타입과 동일하다.</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> StateProps = User</span><br></pre></td></tr></table></figure><p>로 정의해도되고 코드에서 StateProps를 User로 치환해도 된다. 이 경우는 예제를 위해 특수한 케이스기 때문에 이러하지만 여러 state를 props로 연결해야한다라면 곧 확장을 해야하니 StateProps라는 이름의 컨벤션을 유지해서 코드 일관성, 가독성을 확보하자.</p><p>다시 <code>mapStateToProps</code> 함수를 구현한 코드를 보면 아래와 같이 보일 것이 의심치 않는다.</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapStaetToProps = (state: RootState): <span class="function"><span class="params">StateProps</span> =&gt;</span> (&#123;</span><br><span class="line">	name: state.name,</span><br><span class="line">	email: state.email</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>이해를 돕기 위해 완전히 풀어서 보였다. StateProps가 리턴되고 있다는 것만 인지하고 있으면 되며 위와 같은 코드작성은 connect가 타입을 받는 이유와 상충되므로 줄여서 작성하도록 하자.</p><h4><span id="dispatchprops">DispatchProps</span></h4><p>두번째 인자는 dispatch할 액션들이 Component의 props로 매핑된다. 위와 마찬가지로 두번째 인자의 이름인 <code>mapDispatchToProps</code>의 리턴 타입이다.</p><p>완벽한 이해를 위해 아래와 같이 액션이 정의해보자.</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> contactBglee = <span class="function">(<span class="params"><span class="keyword">from</span>: <span class="built_in">string</span></span>) =&gt;</span> (&#123;</span><br><span class="line">	<span class="keyword">type</span>: <span class="string">'CONTACT_BGLEE'</span></span><br><span class="line">	payload: &#123;</span><br><span class="line">		<span class="keyword">from</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>액션은 <code>type</code>을 포함하는 오브젝트를 리턴하는 함수이며 <code>bindActionCreators</code>함수를 통해 dispatch가능한 형태가 된다.</p><p>그럼 두번째 인자의 구현부를 다시 보자.</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatch = bindActionCreators(&#123;&#125;, dispatch)</span><br></pre></td></tr></table></figure><p>이름을 달고 정의한 액션을 바인딩해보자</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function"><span class="params">dispatch</span> =&gt;</span> bindActionCreators(&#123;</span><br><span class="line">	contactBglee</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>작성된 <code>mapDispatchToProps</code>함수를 두번째 인자로 전달하게 되며 Container는 <code>contactBglee</code>액션을 디스패칭할 수 있다. Container는 <code>contactBglee</code> props를 가지고 있다는 의미며 이를 컴파일러에게 알려주기위해 두번째 DispatchProps는 아래와 같이 정의된다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">interface Dispatchprops &#123;</span><br><span class="line">	contactBglee: typeof contactBglee</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>typeof</code>를 유심히 보자 contactBglee의 액션이 <code>from: string</code>인자를 취하는데 이를 재 다시 정의하는 것이아니라 기존 정의로부터 타입을 가지고 와서 추가해준다. 따라서 우린 중복정의 없이 기존 정의를 <code>typeof</code> 키워드를 통해서 쓸 수 있다.</p><h4><span id="ownprops">OwnProps</span></h4><p>마지막 타입은 기존 우리가 컴포넌트를 정의할 때 받는 부모로 부터 받게되는 그 인자를 정의하면 된다. <strong>컴포넌트를 컨테이너로 변경하는 경우라면 기존 컴포넌트의 인자가 OwnProps로 변경된다.</strong></p><hr><p>개인적으로 수없이 정의하게 되는 이런 타입과 함수들이 매우 반복적이기 때문에 <code>mapStateToProps</code>와 같은 함수를 정의하는 대신 inline으로 삽입하는 것을 선호하며 위에 설명한 것들을 함쳐 결과를 보면 아래와 같다.</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;connect, bindActionCreataors&#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">import</span> &#123;contactBglee&#125; <span class="keyword">from</span> <span class="string">'./actions'</span> <span class="comment">// 액션이 존재하는 곳</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> StateProps <span class="keyword">extends</span> User &#123;&#125; <span class="comment">// type으로 정의도 가능하다</span></span><br><span class="line"><span class="keyword">interface</span> DispatchProps &#123;</span><br><span class="line">	contactBglee: <span class="keyword">typeof</span> contactBglee</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> OwnProps &#123;&#125;</span><br><span class="line"><span class="keyword">type</span> Props = StateProps &amp; DispatchProps &amp; OwnProps</span><br><span class="line"><span class="keyword">interface</span> State &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Container = connect&lt;StateProps, DispatchProps, OwnProps&gt;(</span><br><span class="line">	(state: RootState) =&gt; (&#123;</span><br><span class="line">		...state.bglee</span><br><span class="line">	&#125;),</span><br><span class="line">	dispatach =&gt; bindActionCreators(&#123;</span><br><span class="line">		contactBglee</span><br><span class="line">	&#125;, dispatch)</span><br><span class="line">)(</span><br><span class="line">	<span class="keyword">class</span> Component <span class="keyword">extends</span> React.Component&lt;Props, State&gt; &#123;</span><br><span class="line">		render() &#123;</span><br><span class="line">			<span class="keyword">return</span>	&lt;p&gt;hello world&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">		&#125;</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure><h2><span id="next">next</span></h2><p>이제 <code>render()</code>함수 안에서 this.props 그리고 <code>.</code>을 찍어보자.</p></div><div class="article-tags"></div><section id="comments" class="white-box"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section></article><script>document.getElementById("loading-bar").style.width="60%"</script></main><footer id="footer" class="clearfix"><div class="search"><form name="searchform" id="searchform" class="u-search-form"><input type="text" id="searchinput" class="u-search-input st-default-search-input" data-list-highlight="true" data-list-value-completion="true" placeholder="Looking for something?"> <button type="submit" id="u-search-btn-submit" class="u-search-btn-submit"><span class="icon icon-search"></span></button></form></div><div>&copy; <a href="http://blog.bglee.me">봉로그</a> Theme by <a href="http://artifact.me/" target="_blank">Art Chen</a>.</div><div>Powered by <a href="https://hexo.io/" rel="external">Hexo</a>.</div></footer><script>document.getElementById("loading-bar").style.width="80%"</script><div class="overlay"></div></div><div class="site-sidebar"><div class="sidebar-switch clearfix" style="display:none"><a class="dark-btn active" data-toggle="toc"><span class="icon icon-list"></span> <span class="text">Index</span> </a><a class="dark-btn" data-toggle="bio"><span class="icon icon-person"></span> <span class="text">Bio</span></a></div><div class="site-toc" style="display:none"><div class="no-index">No Index</div></div><div class="site-bio show" style="display:block"><div class="about-me clearfix"><div class="avatar"><img src="https://avatars1.githubusercontent.com/u/1223020?s=400&u=c3a99ef61b76bff024adc28d0c884265fbea98a0&v=4"></div><div class="info"><a class="name dark-btn" href="../../../index.htmlabout">deptno@gmail.com</a></div><div class="info"><span class="item desc">코드를 넘어</span></div></div><div class="social clearfix"><a href="https://medium.com/feed/@deptno" class="feed" target="_blank" rel="external"><span class="icon icon-feed"></span> </a><a href="mailto:deptno@gmail.com" class="mail" target="_blank" rel="external"><span class="icon icon-mail"></span> </a><a href="https://github.com/deptno" class="github" target="_blank" rel="external"><span class="icon icon-github"></span> </a><a href="https://twitter.com/deptno" class="twitter" target="_blank" rel="external"><span class="icon icon-twitter"></span> </a><a href="https://plus.google.com/u/0/+이봉균" class="google" target="_blank" rel="external"><span class="icon icon-google"></span> </a><a href="https://www.facebook.com/bonggyun.lee.7" class="facebook" target="_blank" rel="external"><span class="icon icon-facebook"></span> </a><a href="https://www.linkedin.com/in/bonggyun-lee-b55359b3/" class="linkedin" target="_blank" rel="external"><span class="icon icon-linkedin"></span> </a><a href="https://www.instagram.com/deptno/" class="instagram" target="_blank" rel="external"><span class="icon icon-instagram"></span> </a><a href="../../../atom.xml" class="feed" target="_blank" rel="external"><span class="icon icon-feed"></span></a></div><div class="shortcuts clearfix"><div class="bk"><a href="#header" class="dark-btn window-nav"><span class="icon icon-chevron-thin-up"></span> <span class="text">Back to Top</span></a></div><div class="bk"><a href="#footer" class="dark-btn window-nav"><span class="icon icon-chevron-thin-down"></span> <span class="text">Go to Bottom</span></a></div></div></div></div><script type="text/javascript">var GOOGLE_CUSTOM_SEARCH_API_KEY="",GOOGLE_CUSTOM_SEARCH_ENGINE_ID="",ALGOLIA_API_KEY="",ALGOLIA_APP_ID="",ALGOLIA_INDEX_NAME="",AZURE_SERVICE_NAME="",AZURE_INDEX_NAME="",AZURE_QUERY_KEY="",BAIDU_API_ID="",SEARCH_SERVICE="hexo"</script><script src="https://code.jquery.com/jquery-2.1.4.min.js"></script><script>window.jQuery||document.write('<script src="/js/jquery.js"><\/script>')</script><script src="../../../js/search.js"></script><script src="../../../js/app.js"></script><script type="text/javascript">var disqus_shortname="deptno",disqus_url="http://blog.bglee.me/posts/2017/typescript-redux-connect/";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><script>document.getElementById("loading-bar").style.width="100%"</script></body></html>