<!DOCTYPE html><html><head><meta charset="utf-8"><title>타입스크립트 모노레포 | 봉로그</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="TypeScript, Monorepo타입스크립트와 모노레포 셋업은 매우 지난한 싸움이다. 맞지 않는 부분도 상당히 많다. 내가 일전에 무엇을 남겼는지 기억은 나지 않으나 비슷한 글을 남겼었다.🌸 모노레포. Lerna? Yarn Worksapce!위 글에 모노레포가 왜 필요지에 대해서는 남겨 놨을 것이라 생각한다. 어떻게 셋업을 하는지 글을 남겼었지만 그럼"><meta name="keywords" content="react,typescript,monorepo,next,create-react-app,cra"><meta property="og:type" content="article"><meta property="og:title" content="타입스크립트 모노레포"><meta property="og:url" content="http://blog.bglee.me/posts/2018/typescript-monorepo/index.html"><meta property="og:site_name" content="봉로그"><meta property="og:description" content="TypeScript, Monorepo타입스크립트와 모노레포 셋업은 매우 지난한 싸움이다. 맞지 않는 부분도 상당히 많다. 내가 일전에 무엇을 남겼는지 기억은 나지 않으나 비슷한 글을 남겼었다.🌸 모노레포. Lerna? Yarn Worksapce!위 글에 모노레포가 왜 필요지에 대해서는 남겨 놨을 것이라 생각한다. 어떻게 셋업을 하는지 글을 남겼었지만 그럼"><meta property="og:locale" content="ko"><meta property="og:image" content="http://blog.bglee.me/posts/2018/typescript-monorepo/1*thsoeHGmHzCeaPWOCBlQUg.png"><meta property="og:updated_time" content="2018-08-15T09:45:58.538Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="타입스크립트 모노레포"><meta name="twitter:description" content="TypeScript, Monorepo타입스크립트와 모노레포 셋업은 매우 지난한 싸움이다. 맞지 않는 부분도 상당히 많다. 내가 일전에 무엇을 남겼는지 기억은 나지 않으나 비슷한 글을 남겼었다.🌸 모노레포. Lerna? Yarn Worksapce!위 글에 모노레포가 왜 필요지에 대해서는 남겨 놨을 것이라 생각한다. 어떻게 셋업을 하는지 글을 남겼었지만 그럼"><meta name="twitter:image" content="http://blog.bglee.me/posts/2018/typescript-monorepo/1*thsoeHGmHzCeaPWOCBlQUg.png"><link rel="icon" href="../../../favicon.png"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-74859643-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-74859643-1")</script><link href="https://fonts.googleapis.com/css?family=Lato:400,400i,700" rel="stylesheet"><link rel="stylesheet" href="../../../icomoon/style.css"><link rel="stylesheet" href="../../../style.css"></head><body><div class="site-wrapper"><div id="loading-bar-wrapper"><div id="loading-bar"></div></div><script>document.getElementById("loading-bar").style.width="20%"</script><header id="header" class="site-header clearfix"><a class="logo square clearfix" href="../../../index.html"><span class="b">봉 </span><span class="w">로 </span><span class="b">그 </span></a><a class="me square site-nav-switch clearfix"><span class="b"><span class="icon icon-menu"></span></span></a></header><script>document.getElementById("loading-bar").style.width="40%"</script><main id="main" class="clearfix"><article id="post-typescript-monorepo" class="article white-box article-type-post" itemscope itemprop="blogPost"><header class="article-header"><h1 class="article-title" itemprop="name">타입스크립트 모노레포</h1><div class="article-meta">Posted on <time class="article-time" datetime="2018-08-15T09:45:58.000Z" itemprop="datePublished">8월 15, 2018</time></div></header><div class="article-entry" itemprop="articleBody"><h2><span id="typescript-monorepo">TypeScript, Monorepo</span></h2><p>타입스크립트와 모노레포 셋업은 매우 지난한 싸움이다. 맞지 않는 부분도 상당히 많다. 내가 일전에 무엇을 남겼는지 기억은 나지 않으나 비슷한 글을 남겼었다.</p><p><a href="https://medium.com/@deptno/monorepo-yarn-workspace-e81e3e078100" target="_blank" rel="noopener">🌸 모노레포. Lerna? Yarn Worksapce!</a></p><p>위 글에 모노레포가 왜 필요지에 대해서는 남겨 놨을 것이라 생각한다. 어떻게 셋업을 하는지 글을 남겼었지만 그럼에도 불구하고 타입스크립트를 마주하면 쉽지않은 상황이 발생한다. 특히 <strong>프론트엔드</strong>에서 그러하다.</p><p>프로젝트를 가볍게 생성한다고 해보자. 내가 자주 쓰는 Next.js 의 <a href="https://github.com/deptno/next.js-typescript-starter-kit" target="_blank" rel="noopener">빵판</a> 이나 아니면 그냥 <code>create-react-app</code> 에 <code>react-scripts-ts</code> 를 먹여서 TypeScript 로 프로젝트를 셋업하면 작업하는 내내 <code>.js</code> , <code>.map</code> 등은 더이상 밖으로 노출되지 않고 메모리안에서 처리된다. 때문에 우리는 <code>.gitignore</code> 를 따로 처리하면서 파일 IO에 대한 성능 이슈등으로 부터 자유롭다. 바람직하다.</p><h2><span id="그럼-무엇이-문제인가">그럼 무엇이 문제인가?</span></h2><p>모노레포의 구성은 아래 사진과 유사하다.</p><p><img src="1*thsoeHGmHzCeaPWOCBlQUg.png" alt="img"></p><p>이 이미지는 이전에 쓴 글에서 가져온 것인데 프론트엔드가 없는 라이브러리의 구현 구조다. 구조를 보면 <code>feed</code>, <code>html</code>, <code>readme</code>, <code>speech</code> 의 패키지가 존재한다. 편의상 <code>readme</code> 를 <code>create-react-app</code> 등으로 생성한 메인 <strong>클라이언트 앱</strong> 이라고 생각하자. 그럼 여기서 <code>packages/readme/index.js</code> 는 지워진다. 프로젝트 셋업에 따라 <code>.js</code>는 관리하지도 보여지지도 않는다.</p><p>나머지 패키지들은 컴파일의 결과로써 <code>.js</code> 을 유지해야한다. 각 패키지를 <strong>리엑트 컴포넌트</strong> 라고 생각하고 메인인 <code>readme</code> 에서 참조를 하게 되면 모노레포의 구성 이유와 같이 외부 모듈로 처리하므로 <code>import</code> 구문을 통해 로드시에 <code>.js</code> 가 로드되므로 반드시 <code>.js</code> 가 필요하다.</p><p>그럼 메인 프로젝트인 <code>readme</code> 는 컴파일을 따로 돌려서 <code>.js</code> 를 생성하면 안되고 나머지 패키지들에 대해서는 컴파일을 통해 <code>.js</code> 를 생성해야한다. 이 부분이 타입스크립트와 모노레포의 조합을 매우 어렵게 만든다. 부분마다 따로 컴파일을 돌리고 IDE 셋업에 매이는등 많은 삽질을 하다가 아마 그만뒀던 경험을 가진 개발자들도 여럿(나만? <span class="github-emoji" title="eyes" data-src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f440.png?v8">&#x1f440;</span>)있을지 모르겠다.</p><h2><span id="typescript-3">TypeScript 3</span></h2><p>섹션이 하나 더 들어가야하는데 <strong>시행착오</strong>에 대해서 적을까 하다가 그에 대한 잘 씌여진 글로 대체한다. TypeScript 공식 사이트의 프로젝트 레퍼런스 핸드북과 후이서울에서 작성한 글이다.</p><ul><li><a href="https://engineering.huiseoul.com/타입스크립트-3-0-99e5d45ec439" target="_blank" rel="noopener">https://engineering.huiseoul.com/타입스크립트-3-0-99e5d45ec439</a></li><li><a href="https://www.typescriptlang.org/docs/handbook/project-references.html" target="_blank" rel="noopener">https://www.typescriptlang.org/docs/handbook/project-references.html</a></li></ul><p>모노레포에 관련된 글은 아니다. 그러나 프로젝트 빌드와 관련해서 인상적인 발전이 있었다. <code>--build</code> 명령어와 프로젝트 참조를 통해 순차적으로 효율적인 빌드를 적용한다 뭐 이런 내용인데 자세한 내용은 문서에 있다.</p><h2><span id="monorepo">Monorepo</span></h2><p>그럼 다시 모노레포로 돌아오자. <code>next</code> 나 <code>create-react-app</code> 의 개발환경이 돌면서 추가적으로 나머지 패키지들에서 빌드가 같이 돌아줘야한다. 나머지 패키지들은 컴파일을 통해서 <code>.js</code> 를 생산해 낼 것이고 메인 앱에서는 이들이 <code>.js</code> 를 가지고 있으므로 개발환경에서 바로바로 <code>import</code> 를 할 수 있게 된다.</p><p>드디어 추가된 타입스크립트@3 의 프로젝트 레퍼런스와 <code>--build</code> 를 통해 더러운 <strong>프론트엔드 + 타입스크립트 + 모노레포</strong> 가능해진다.</p><p>이에 대한 설명은 글보다 코드로 대신한다.</p><ul><li><a href="https://github.com/deptno/typescript-monorepo-next-example" target="_blank" rel="noopener">Next.js 버전</a></li><li><a href="https://github.com/deptno/typescript-monorepo-cra-example" target="_blank" rel="noopener">create-react-app 버전</a></li></ul><hr><p>등아파서 글을 길게 못쓰겠다…</p></div><div class="article-tags"><a class="tag-link" href="../../../tags/cra/">cra</a><a class="tag-link" href="../../../tags/create-react-app/">create-react-app</a><a class="tag-link" href="../../../tags/monorepo/">monorepo</a><a class="tag-link" href="../../../tags/next/">next</a><a class="tag-link" href="../../../tags/react/">react</a><a class="tag-link" href="../../../tags/typescript/">typescript</a></div><section id="comments" class="white-box"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section></article><script>document.getElementById("loading-bar").style.width="60%"</script></main><footer id="footer" class="clearfix"><div class="search"><form name="searchform" id="searchform" class="u-search-form"><input type="text" id="searchinput" class="u-search-input st-default-search-input" data-list-highlight="true" data-list-value-completion="true" placeholder="Looking for something?"> <button type="submit" id="u-search-btn-submit" class="u-search-btn-submit"><span class="icon icon-search"></span></button></form></div><div>&copy; <a href="http://blog.bglee.me">봉로그</a> Theme by <a href="http://artifact.me/" target="_blank">Art Chen</a>.</div><div>Powered by <a href="https://hexo.io/" rel="external">Hexo</a>.</div></footer><script>document.getElementById("loading-bar").style.width="80%"</script><div class="overlay"></div></div><div class="site-sidebar"><div class="sidebar-switch clearfix" style="display:none"><a class="dark-btn active" data-toggle="toc"><span class="icon icon-list"></span> <span class="text">Index</span> </a><a class="dark-btn" data-toggle="bio"><span class="icon icon-person"></span> <span class="text">Bio</span></a></div><div class="site-toc" style="display:none"><div class="no-index">No Index</div></div><div class="site-bio show" style="display:block"><div class="about-me clearfix"><div class="avatar"><img src="https://avatars1.githubusercontent.com/u/1223020?s=400&u=c3a99ef61b76bff024adc28d0c884265fbea98a0&v=4"></div><div class="info"><a class="name dark-btn" href="../../../index.htmlabout">deptno@gmail.com</a></div><div class="info"><span class="item desc">코드를 넘어</span></div></div><div class="social clearfix"><a href="https://medium.com/feed/@deptno" class="feed" target="_blank" rel="external"><span class="icon icon-feed"></span> </a><a href="mailto:deptno@gmail.com" class="mail" target="_blank" rel="external"><span class="icon icon-mail"></span> </a><a href="https://github.com/deptno" class="github" target="_blank" rel="external"><span class="icon icon-github"></span> </a><a href="https://twitter.com/deptno" class="twitter" target="_blank" rel="external"><span class="icon icon-twitter"></span> </a><a href="https://plus.google.com/u/0/+이봉균" class="google" target="_blank" rel="external"><span class="icon icon-google"></span> </a><a href="https://www.facebook.com/bonggyun.lee.7" class="facebook" target="_blank" rel="external"><span class="icon icon-facebook"></span> </a><a href="https://www.linkedin.com/in/bonggyun-lee-b55359b3/" class="linkedin" target="_blank" rel="external"><span class="icon icon-linkedin"></span> </a><a href="https://www.instagram.com/deptno/" class="instagram" target="_blank" rel="external"><span class="icon icon-instagram"></span> </a><a href="../../../atom.xml" class="feed" target="_blank" rel="external"><span class="icon icon-feed"></span></a></div><div class="shortcuts clearfix"><div class="bk"><a href="#header" class="dark-btn window-nav"><span class="icon icon-chevron-thin-up"></span> <span class="text">Back to Top</span></a></div><div class="bk"><a href="#footer" class="dark-btn window-nav"><span class="icon icon-chevron-thin-down"></span> <span class="text">Go to Bottom</span></a></div></div></div></div><script type="text/javascript">var GOOGLE_CUSTOM_SEARCH_API_KEY="",GOOGLE_CUSTOM_SEARCH_ENGINE_ID="",ALGOLIA_API_KEY="",ALGOLIA_APP_ID="",ALGOLIA_INDEX_NAME="",AZURE_SERVICE_NAME="",AZURE_INDEX_NAME="",AZURE_QUERY_KEY="",BAIDU_API_ID="",SEARCH_SERVICE="hexo"</script><script src="https://code.jquery.com/jquery-2.1.4.min.js"></script><script>window.jQuery||document.write('<script src="/js/jquery.js"><\/script>')</script><script src="../../../js/search.js"></script><script src="../../../js/app.js"></script><script type="text/javascript">var disqus_shortname="deptno",disqus_url="http://blog.bglee.me/posts/2018/typescript-monorepo/";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><script>document.getElementById("loading-bar").style.width="100%"</script></body></html>