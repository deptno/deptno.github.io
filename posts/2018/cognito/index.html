<!DOCTYPE html><html><head><meta charset="utf-8"><title>Cognito, Multi IDP Login 분석 | 봉로그</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="Cognito, multi IDP login"><meta name="keywords" content="cognito,multi idp,idp,user pool,federated Identities"><meta property="og:type" content="article"><meta property="og:title" content="Cognito, Multi IDP Login 분석"><meta property="og:url" content="http://blog.bglee.me/posts/2018/cognito/index.html"><meta property="og:site_name" content="봉로그"><meta property="og:description" content="Cognito, multi IDP login"><meta property="og:locale" content="ko"><meta property="og:image" content="http://blog.bglee.me/posts/2018/cognito/federated_identities_logins.png"><meta property="og:updated_time" content="2018-07-17T16:43:30.661Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Cognito, Multi IDP Login 분석"><meta name="twitter:description" content="Cognito, multi IDP login"><meta name="twitter:image" content="http://blog.bglee.me/posts/2018/cognito/federated_identities_logins.png"><link rel="icon" href="../../../favicon.png"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-74859643-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-74859643-1")</script><link href="https://fonts.googleapis.com/css?family=Lato:400,400i,700" rel="stylesheet"><link rel="stylesheet" href="../../../icomoon/style.css"><link rel="stylesheet" href="../../../style.css"></head><body><div class="site-wrapper"><div id="loading-bar-wrapper"><div id="loading-bar"></div></div><script>document.getElementById("loading-bar").style.width="20%"</script><header id="header" class="site-header clearfix"><a class="logo square clearfix" href="../../../index.html"><span class="b">봉 </span><span class="w">로 </span><span class="b">그 </span></a><a class="me square site-nav-switch clearfix"><span class="b"><span class="icon icon-menu"></span></span></a></header><script>document.getElementById("loading-bar").style.width="40%"</script><main id="main" class="clearfix"><article id="post-cognito" class="article white-box article-type-post" itemscope itemprop="blogPost"><header class="article-header"><h1 class="article-title" itemprop="name">Cognito, Multi IDP Login 분석</h1><div class="article-meta">Posted on <time class="article-time" datetime="2018-07-16T18:00:00.000Z" itemprop="datePublished">7월 17, 2018</time></div></header><div class="article-entry" itemprop="articleBody"><blockquote><p><span class="github-emoji" title="warning" data-src="https://assets-cdn.github.com/images/icons/emoji/unicode/26a0.png?v8">&#x26a0;</span> 작성 중</p></blockquote><blockquote><p><span class="github-emoji" title="warning" data-src="https://assets-cdn.github.com/images/icons/emoji/unicode/26a0.png?v8">&#x26a0;</span> 개인적인 정리라 확실성을 띄는 단어를 사용하지만 실제론 그렇지 않을 수 있다.</p></blockquote><blockquote><p>이 글은 목적이 존재하며 Cognito 의 소개 글이 아니다. Cognito 는 AWS 문서를 참조 바란다.</p></blockquote><blockquote><p>현재라는 문구가 사용되면 작성 시점인 2018년 7월 17일이다.</p></blockquote><p><code>사용자 풀</code> 과 <code>연동 자격 증명 풀</code> 두 가지가 존재하며 각각 따로 생성이 가능하며 연동도 가능하다. 궁극적으로 알고자 하는 것은 아래 와 같다.</p><ol><li>여러 IDP의 로그인을 통해 정보를 취합하는 앱을 만들경우 이 로그인 정보들을 어떻게 취합해서 어떻게 관리할 것인가?</li><li>사용자 풀 에서도 IDP 를 연동할 수 있고, 연동 자격 증명에서도 사용자 풀과 여타 IDP 연결이 가능한데, 무엇이 다른가?</li></ol><p>특별히 궁금한 부분은 AWS 문서에도 <a href="https://docs.aws.amazon.com/ko_kr/cognito/latest/developerguide/cognito-user-pools-identity-federation.html" target="_blank" rel="noopener">노트</a>로도 표시되어 있다.</p><blockquote><p>참고</p><p>타사(연동)를 통한 로그인을 Amazon Cognito 사용자 풀에서 사용할 수 있습니다. 이 기능은 Amazon Cognito 자격 증명 풀(연동 자격 증명)을 통한 연동과 무관합니다.</p></blockquote><p>결국 두 방식은 다르다는 뜻으로 해석되며 <strong>2 번과 관련해서는 예상 되는 결과</strong> 는 아래와 같다.</p><ul><li><p>사용자 풀 베이스</p><p>회원가입 후 로그인 이후에 IDP 로그인을 지원하며 이에 따라 정보가 자연스럽게 취합이 가능.</p></li><li><p>연동 자격 증명 베이스</p><p>로그인 퍼스트 전략으로 인증된 IDP와 앱이라면 일단 로그인이 가능하며 그에 따른 인가가 이루어짐.</p></li></ul><h2><span id="사용자-풀">사용자 풀</span></h2><p>사용자 풀은 자체 DB를 갖는 일반적인 구현 형태와 같다. 때문에 회원 가입, 회원 정보, 로그인 방식(MFA 와 같은), SMS, Email 인증등을 전반적으로 제어 할 수 있다.</p><h3><span id="연동-gt-자격-증명-공급자">연동 &gt; 자격 증명 공급자</span></h3><p>일단 연동 자격 증명과는 달리 입력 요구사항이 다르다.</p><blockquote><p>ID(Client ID) 외에 앱 보안(Secret Key)를 요구하고 인증 범위(Scope)에 대한 지정이 가능하다. 명시적(explicit) 또는 3-way 로그인 방식에서 쓰이는 요구 사항과 같으며 이에 대한 뒷 작업을 Cognito가 해주는 것으로 예상 된다.</p></blockquote><h4><span id="현재-지원되는-idp">현재 지원되는 IDP</span></h4><ul><li>Facebook</li><li>Google</li><li>Login with Amazon</li><li>SAML</li><li>OpenID Connect</li></ul><h3><span id="연동-gt-속성">연동 &gt; 속성</span></h3><blockquote><p>IDP 로그인을 통해 들어온 정보와 가입시의 정보가 다른 경우 어떤 정보가 저장되는가?</p></blockquote><hr><h2><span id="연동-자격-증명federated-identities">연동 자격 증명(Federated Identities)</span></h2><p>기본적으로는 <strong>사용자 풀</strong> 없이도 단지 인증된 <strong>IDP</strong>와 <strong>앱 정보</strong>를 통해 유저를 인증하고 <strong>롤</strong>(IAM)에 따라 인가할 수 있다. 간단한 어플리케이션에서 유용할 것으로 보인다.</p><h3><span id="자격-증명-풀-편집">자격 증명 풀 편집</span></h3><p><strong>인증되지 않은 역할</strong>, <strong>인증된 역할</strong>에 IAM을 할당하여 권한을 지정 함</p><h3><span id="인증-공급자">인증 공급자</span></h3><p><strong>인증 공급자(Identity Provider - IDP)</strong>를 등록한다. 인증 공급자는 OAuth를 지원 업체로 생각 할 수 있다.</p><p><strong>IDP</strong> 등록을 위해서는 각 <strong>IDP</strong> 에서 생성한 App ID 가 필요하며 여기서 등록해 둔다.</p><blockquote><p><code>예제 0</code> 페이스북을 통해 얻은 토큰 등록</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">AWS.config.credentials = <span class="keyword">new</span> AWS.CognitoIdentityCredentials(&#123;</span><br><span class="line">    IdentityPoolId: &lt;연동 자격 증명 풀 ID&gt;,</span><br><span class="line">    Logins        : &#123;</span><br><span class="line">        'graph.facebook.com': response.authResponse.accessToken&lt;Facebook access token&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>이렇게 <code>credentials</code> 를 등록함으로써 로그인이 된 것으로 간주하고 <strong>인증된 역할</strong> 의 권한을 얻는다.</p><h4><span id="여러-idp를-통해-로그인이-필요한-경우">여러 IDP를 통해 로그인이 필요한 경우</span></h4><p>여러 IDP를 통해서 로그인이 필요한 경우에는 각 로그인마다 다른 유저로 인식 되므로 이전 로그인 정보를 취합하여 다시 저장할 필요가 있다. 즉, <code>Logins</code> 의 오브젝트를 확장해야한다. 코드로 표현하면 다음과 같을 것으로 보인다.</p><blockquote><p><code>예제 1</code> 여러 IDP 토콘을 저장하는 경우</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">AWS.config.credentials = <span class="keyword">new</span> AWS.CognitoIdentityCredentials(&#123;</span><br><span class="line">    IdentityPoolId: &lt;연동 자격 증명 풀 ID&gt;,</span><br><span class="line">    Logins        : &#123;</span><br><span class="line">        'graph.facebook.com': response.authResponse.accessToken&lt;Facebook 억세스 토큰&gt;,</span><br><span class="line">	    'cognito-idp.&lt;리전&gt;.amazonaws.com/&lt;유저풀 ID&gt;': result.getIdToken().getJwtToken()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p><code>예제 2</code> 순서가 정의되고 이미 <code>credentials</code> 이 이미 등록어 있어 이를 확장하는 경우</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">AWS.config.credentials = <span class="keyword">new</span> AWS.CognitoIdentityCredentials(&#123;</span><br><span class="line">    IdentityPoolId: &lt;연동 자격 증명 풀 ID&gt;,</span><br><span class="line">    Logins        : &#123;</span><br><span class="line">        ...AWS.config.credentials,</span><br><span class="line">	    'cognito-idp.&lt;리전&gt;.amazonaws.com/&lt;유저풀 ID&gt;': result.getIdToken().getJwtToken()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4><span id="현재-지원되는-idp-목록">현재 지원되는 <strong>IDP</strong> 목록</span></h4><ul><li>Cognito</li><li>Amazon</li><li>Facebook</li><li>Google+</li><li>Twitter / Digits</li><li>OpenID</li><li>SAML</li><li>사용자 지정</li></ul><h4><span id="use-case">Use Case</span></h4><h5><span id="두개의-idp-facebook-으로-로그인-후-cognito-로-다시-인증하는-경우">두개의 IDP: Facebook 으로 로그인 후, Cognito 로 다시 인증하는 경우</span></h5><p><code>예제 0</code> 의 코드와 같은 방식으로 두번 각기 등록하는 경우는 유저가 2명으로 인식되나 <code>Logins</code> 에 두 정보를 함께 등록하는 경우 이 정보가 취합되어 한명의 유저로 인식된다.</p><p><code>Logins</code> 에 한번이라도 함께 등록되면 각기 다른 <strong>IDP</strong>에 의해 발급된 두개의 토큰은 함께 연결되는 것으로 보인다. 때문에 함께 저장하는 순간 유저 수 인식이 2 에서 1명으로 변경된다.</p><p><img src="federated_identities_logins.png" alt="federated_identities_logins"></p><p>위 이미지는 <code>Logins</code> 에 함께 저장 후 대쉬보드의 화면이며 <strong>Facebook</strong> 로그인(파란색)과 <strong>Cognito</strong> 로그인(녹색)이 각각 카운트가 1이나 총 자격 증명이 1 로 인식되는 걸 확인 할 수 있다. 함께 저장하기 전에는 총 자격 증명이 2 였다.</p></div><div class="article-tags"><a class="tag-link" href="../../../tags/cognito/">cognito</a><a class="tag-link" href="../../../tags/federated-Identities/">federated Identities</a><a class="tag-link" href="../../../tags/idp/">idp</a><a class="tag-link" href="../../../tags/multi-idp/">multi idp</a><a class="tag-link" href="../../../tags/user-pool/">user pool</a></div><section id="comments" class="white-box"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section></article><script>document.getElementById("loading-bar").style.width="60%"</script></main><footer id="footer" class="clearfix"><div class="search"><form name="searchform" id="searchform" class="u-search-form"><input type="text" id="searchinput" class="u-search-input st-default-search-input" data-list-highlight="true" data-list-value-completion="true" placeholder="Looking for something?"> <button type="submit" id="u-search-btn-submit" class="u-search-btn-submit"><span class="icon icon-search"></span></button></form></div><div>&copy; <a href="http://blog.bglee.me">봉로그</a> Theme by <a href="http://artifact.me/" target="_blank">Art Chen</a>.</div><div>Powered by <a href="https://hexo.io/" rel="external">Hexo</a>.</div></footer><script>document.getElementById("loading-bar").style.width="80%"</script><div class="overlay"></div></div><div class="site-sidebar"><div class="sidebar-switch clearfix" style="display:none"><a class="dark-btn active" data-toggle="toc"><span class="icon icon-list"></span> <span class="text">Index</span> </a><a class="dark-btn" data-toggle="bio"><span class="icon icon-person"></span> <span class="text">Bio</span></a></div><div class="site-toc" style="display:none"><div class="no-index">No Index</div></div><div class="site-bio show" style="display:block"><div class="about-me clearfix"><div class="avatar"><img src="https://avatars1.githubusercontent.com/u/1223020?s=400&u=c3a99ef61b76bff024adc28d0c884265fbea98a0&v=4"></div><div class="info"><a class="name dark-btn" href="../../../index.htmlabout">deptno@gmail.com</a></div><div class="info"><span class="item desc">주섬주섬...</span></div></div><div class="social clearfix"><a href="https://medium.com/feed/@deptno" class="feed" target="_blank" rel="external"><span class="icon icon-feed"></span> </a><a href="mailto:deptno@gmail.com" class="mail" target="_blank" rel="external"><span class="icon icon-mail"></span> </a><a href="https://github.com/deptno" class="github" target="_blank" rel="external"><span class="icon icon-github"></span> </a><a href="https://twitter.com/deptno" class="twitter" target="_blank" rel="external"><span class="icon icon-twitter"></span> </a><a href="https://plus.google.com/u/0/+이봉균" class="google" target="_blank" rel="external"><span class="icon icon-google"></span> </a><a href="https://www.facebook.com/bonggyun.lee.7" class="facebook" target="_blank" rel="external"><span class="icon icon-facebook"></span> </a><a href="https://www.linkedin.com/in/bonggyun-lee-b55359b3/" class="linkedin" target="_blank" rel="external"><span class="icon icon-linkedin"></span> </a><a href="https://www.instagram.com/deptno/" class="instagram" target="_blank" rel="external"><span class="icon icon-instagram"></span> </a><a href="../../../atom.xml" class="feed" target="_blank" rel="external"><span class="icon icon-feed"></span></a></div><div class="shortcuts clearfix"><div class="bk"><a href="#header" class="dark-btn window-nav"><span class="icon icon-chevron-thin-up"></span> <span class="text">Back to Top</span></a></div><div class="bk"><a href="#footer" class="dark-btn window-nav"><span class="icon icon-chevron-thin-down"></span> <span class="text">Go to Bottom</span></a></div></div></div></div><script type="text/javascript">var GOOGLE_CUSTOM_SEARCH_API_KEY="",GOOGLE_CUSTOM_SEARCH_ENGINE_ID="",ALGOLIA_API_KEY="",ALGOLIA_APP_ID="",ALGOLIA_INDEX_NAME="",AZURE_SERVICE_NAME="",AZURE_INDEX_NAME="",AZURE_QUERY_KEY="",BAIDU_API_ID="",SEARCH_SERVICE="hexo"</script><script src="https://code.jquery.com/jquery-2.1.4.min.js"></script><script>window.jQuery||document.write('<script src="/js/jquery.js"><\/script>')</script><script src="../../../js/search.js"></script><script src="../../../js/app.js"></script><script type="text/javascript">var disqus_shortname="deptno",disqus_url="http://blog.bglee.me/posts/2018/cognito/";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><script>document.getElementById("loading-bar").style.width="100%"</script></body></html>